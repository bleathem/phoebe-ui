#!/bin/bash

# restore build artifacts
if [ "$(ls /tmp/s2i/artifacts/ 2>/dev/null)" ]; then
  echo "Restoring build artifacts."
  mv /tmp/s2i/artifacts/* ./
else
  echo "No artifacts to restore."
fi

# move the application source
mv /tmp/src/* ./

# build application artifacts
NODE_ENV=development npm install -d
npm run build --prod

# Fix source directory permissions
fix-permissions ./
