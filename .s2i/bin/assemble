#!/bin/bash

# restore build artifacts
echo "Current folder:"
pwd
echo "Home folder:"
echo $HOME
ls -la
if [ "$(ls /tmp/s2i/artifacts/ 2>/dev/null)" ]; then
  echo "Restoring build artifacts."
  mv /tmp/s2i/artifacts/* ./
else
  echo "No artifacts to restore."
  echo "/tmp"
  ls -la /tmp
  echo "/tmp/s2i"
  ls -la /tmp/s2i
fi

echo "move the application source"
echo "/tmp/src"
# ls -la /tmp/src
# mv /tmp/src/* ./
#
# echo "Installing npm dependencies"
# NODE_ENV=development npm install

#!/bin/bash
echo "Before assembling"

/usr/libexec/s2i/assemble
rc=$?

if [ $rc -eq 0 ]; then
    echo "After successful assembling"
else
    echo "After failed assembling"
fi

ls -la

echo "npm install complete.  Running ng build..."
# npm run build --prod
./node_modules/.bin/ng build --prod

echo "Fix source directory permissions"
fix-permissions ./
